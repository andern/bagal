      <div id="focus">
        <img src="." />
      </div>
    </div>
    <script>
      const SCROLL_PX_CLOSE = 250;
      const PERCENT_OF_IMAGE_ARROWS = 0.2;

      let cont = document.querySelector('#container');
      let focus = document.querySelector('#focus > img');
      let focusContainer = document.querySelector('#focus');
      let body = document.querySelector('body');
      let imgs = document.querySelectorAll('a:not(.folder) > img');

      let mod = (i, n) => ((i % n) + n) % n;
      let index = 0;
      let scrollStart = 0;

      let x = 0;
      let dx = 0;
      let sliding = false;

      function unify(e) {
        return e.changedTouches ? e.changedTouches[0] : e
      };

      function slideStart (e) {
        x = unify(e).clientX;
        sliding = true;
      }

      function slideMove(e) {
        e.preventDefault();
        if (!sliding) return;
        dx = Math.round(unify(e).clientX - x);
        focus.style.setProperty('--dx', dx + 'px');
      }

      function slideEnd(e) {
        if (!sliding) return;
        sliding = false;

        focusImage(dx > 0 ? index - 1 : index + 1);
        focus.style.setProperty('--dx', '0px');
        dx = 0;
      }

      focus.addEventListener('mousedown', slideStart, false);
      focus.addEventListener('mousemove', slideMove, false);
      focus.addEventListener('mouseup', slideEnd, false);

      focus.addEventListener('touchstart', slideStart, false);
      focus.addEventListener('touchmove', slideMove, false);
      focus.addEventListener('touchend', slideEnd, false);

      let focusImage = (idx) => {
        let i = mod(idx, imgs.length);
        index = i
        scrollStart = window.pageYOffset;

        focus.src = imgs[i].parentNode.href;
        focusContainer.style.display = 'block';
      }

      let closePreview = () => {
        focus.src = '';
        focusContainer.style.display = 'none';
      }

      let imageClickHandler = (idx) => (e) => {
        e.preventDefault();
        e.stopPropagation();
        focusImage(idx);
      };

      document.addEventListener('click', (e) => {
        e.stopPropagation();
        if (e.target == focus) return;
        closePreview();
      });

      for (let i = 0; i < imgs.length; i++) {
        imgs[i].addEventListener('click', imageClickHandler(i));
      }

      document.addEventListener('scroll', (e) => {
        if (Math.abs(window.pageYOffset - scrollStart) >= SCROLL_PX_CLOSE) {
          closePreview();
        }
      });

      document.addEventListener('keyup', (e) => {
        if (e.key === 'Escape') {
          closePreview();
          return;
        }

        if (e.key === 'ArrowRight') focusImage(index + 1);
        else if (e.key === 'ArrowLeft') focusImage(index - 1);
      });
    </script>
  </body>
</html>
